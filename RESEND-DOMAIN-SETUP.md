# Resend ドメイン認証設定ガイド

## 📧 Resendでの送信元ドメイン設定について

Resendでは、**送信元（`from`）のメールアドレスのドメインを認証する必要があります**。

### 重要なポイント

- ✅ **送信元（`from`）のドメイン**: 認証が必要
- ❌ **送信先（`to`）のドメイン**: 認証不要
- ⚠️ **APIキーの「all domains」設定**: これはAPIキーの権限設定であり、ドメイン認証とは別の概念です

## 🎯 2つの選択肢

### 選択肢1: デフォルトの送信元を使用（開発・テスト環境向け）

Resendが提供する認証済みドメイン `onboarding@resend.dev` を使用します。

**⚠️ 企業サイトでは推奨されません**
- 送信元が `onboarding@resend.dev` になるため、ブランディングに不利
- 受信者に不信感を与える可能性がある
- プロフェッショナルな印象を与えない

**用途：**
- 開発環境でのテスト
- プロトタイプ段階
- 一時的な設定

**設定方法：**
1. Vercelの環境変数設定で `RESEND_FROM_EMAIL` を**設定しない**（削除する）
2. コードが自動的に `onboarding@resend.dev` を使用します
3. 追加の設定は不要です

**メリット：**
- 設定が簡単
- ドメイン認証が不要
- すぐに使用可能

**デメリット：**
- 送信元が `onboarding@resend.dev` になる
- 独自ドメインのブランディングができない

### 選択肢2: 独自ドメインを認証する（企業サイト推奨）

自分のドメイン（例: `kurosawa.vn`）を認証して、そのドメインから送信します。

**✅ 企業サイトではこちらが推奨されます**

**理由：**
1. **ブランディング**: 自社ドメインから送信することで、ブランドの一貫性を保てる
2. **信頼性**: 受信者にとって、自社ドメインからのメールの方が信頼できる
3. **プロフェッショナル**: 企業としての信頼性とプロフェッショナルな印象を与える
4. **スパム対策**: 適切に設定されたSPF/DKIM/DMARCレコードにより、スパム判定を回避しやすい
5. **一貫性**: サイトのドメインとメール送信元のドメインが一致する

**設定方法：**

#### ステップ1: Resendでドメインを追加

1. Resendダッシュボードにログイン
2. 左サイドバーから「**Domains**」を選択
3. 「**Add Domain**」ボタンをクリック
4. ドメインを入力（例: `kurosawa.vn`）
   - **注意**: `www` や `http://` は付けない
   - 例: `kurosawa.vn` ✅
   - 例: `www.kurosawa.vn` ❌
   - 例: `https://kurosawa.vn` ❌

#### ステップ2: DNSレコードを設定

Resendが表示するDNSレコードを、ドメインのDNS設定に追加します。

**必要なDNSレコード：**

1. **SPFレコード**（必須）
   - タイプ: `TXT`
   - 名前: `@` またはドメイン名
   - 値: Resendが提供するSPFレコード（例: `v=spf1 include:resend.com ~all`）

2. **DKIMレコード**（必須）
   - タイプ: `TXT`
   - 名前: Resendが提供するホスト名（例: `resend._domainkey`）
   - 値: Resendが提供する長い文字列

3. **DMARCレコード**（推奨）
   - タイプ: `TXT`
   - 名前: `_dmarc`
   - 値: `v=DMARC1; p=none; rua=mailto:dmarc@yourdomain.com`

**DNS設定の場所：**
- ドメインのDNSプロバイダー（例: Cloudflare, Route53, お名前.com等）
- 通常、ドメイン管理画面から設定できます

#### ステップ3: DNS設定の反映を待つ

- DNS設定の反映には数分〜数時間かかることがあります
- 反映状況は `nslookup` や `dig` コマンドで確認できます

#### ステップ4: Resendでドメインを認証

1. Resendダッシュボードの「Domains」ページに戻る
2. 追加したドメインの「**Verify**」ボタンをクリック
3. 認証が成功すると「Verified」と表示されます

#### ステップ5: 環境変数を設定

1. Vercelの環境変数設定を開く
2. `RESEND_FROM_EMAIL` を追加
3. 認証済みドメインのメールアドレスを設定
   - 例: `noreply@kurosawa.vn`
   - 例: `info@kurosawa.vn`
   - 例: `contact@kurosawa.vn`
4. 再デプロイ

**メリット：**
- 独自ドメインから送信できる
- ブランディングに有利
- 信頼性が向上

**デメリット：**
- DNS設定が必要
- 設定に時間がかかる

## 🔍 現在の設定を確認する方法

### Vercelの環境変数を確認

1. Vercelダッシュボード → プロジェクト → Settings → Environment Variables
2. `RESEND_FROM_EMAIL` が設定されているか確認

### Resendで認証済みドメインを確認

1. Resendダッシュボード → Domains
2. 「Verified」と表示されているドメインを確認

### コードで使用される送信元を確認

Runtime Logsで `Sending email:` のログを確認すると、実際に使用されている送信元が表示されます。

## ❓ よくある質問

### Q: APIキーの「all domains」設定とドメイン認証の違いは？

**A:** 
- **APIキーの「all domains」設定**: APIキーがすべてのドメインに対して操作できる権限を設定します。これはAPIキーの権限設定です。
- **ドメイン認証**: 実際にメールを送信する際に、送信元のドメインが認証されている必要があります。これはセキュリティとスパム対策のための設定です。

### Q: 送信先のドメインも認証が必要ですか？

**A:** いいえ、送信先（`to`）のドメインは認証不要です。送信元（`from`）のドメインのみ認証が必要です。

### Q: 複数のドメインを認証できますか？

**A:** はい、Resendでは複数のドメインを認証できます。各ドメインごとにDNSレコードを設定する必要があります。

### Q: サブドメインも認証できますか？

**A:** はい、サブドメイン（例: `mail.kurosawa.vn`）も認証できます。ただし、各サブドメインごとにDNSレコードを設定する必要があります。

## 📚 参考リンク

- Resend公式ドキュメント: https://resend.com/docs
- Resend Domains設定: https://resend.com/domains
- DNS設定ガイド: https://resend.com/docs/dashboard/domains/introduction
